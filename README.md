ig-pipeline
===========

SVM regions/genes predictor
===========================
Location: svm_data_generator

Сборка
------
    cd ./svm_data_generator
    ./compile.sh
    cd ../common_lib
    ./compile.sh

Запуск
------

Пример запуска в скрипте ./run_svm_example.sh
Параметры запсука:
./svm_find_regions.sh input_train.fasta input_kabat input_predict.fasta svm_window_size avg_window_size
* input_train.fasta - файл с обучающими ридами
* input_kabat - файл с разметкой ридов в input_train.fasta в формате kabat. Если в input_train.fasta есть рид, для которого нет разметки kabat, то в лог выведется сообщение вида "Missing nomenclature for read O3_IGKJ3*01{1}"
* input_predict.fasta - входные данные, которые нужно разметить на регионы
* svm_window_size - размер feature-вектора для SVM. Сначала каждый рид разделяется на регионы, и затем каждый регион разделяется скользящим окном на k-меры. Т.о., граничные области не учитываются
* avg_window_size - размер скользящего окна, по которому усредняются предсказания для нуклеотида. Например, 55455 становится 55555 при размере окна 5. Цифра - это номер региона для нуклеотида в данной позиции

Выходные данные
---------------
* В файле debug_prediction.txt:
  IGHV1-18*01	45555555555555555555555555555552544555555555555555555555555555555555555555555555445555555555555255544445555555522255550555555555555555555555555555555555555555555555554555555555555555515555555555555000554455555522225555455555555555125005555555555555554555555555555555555555544444455555555
* В файле debug_prediction_avg.txt:
  IGHV1-18*01	55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555544445555555522255555555555555555555555555555555555555555555555555555555555555555555555555555555555000055555555522225555555555555555550055555555555555555555555555555555555555544444455555555
* В файле results.txt:
  IGHV1-18*01	1	104	105	108	109	116	117	119	120	202	203	206	207	215	216	219	220	237	238	239	240	278	279	284	285	297

* В первом файле предсказания для скользящего окна svm_window_size для рида. Длина строки на len(read) - svm_window_size + 1. Цифра в каждой позиции - это 0-based номер соответствующего региона в input_kabat. FR1 - регион 0, CDR1 - 1 и т.д. Нумерация вместо названия регионов сделана специально - это позволит сделать поиск любых участков, будь то регионы или гены. Нужно лишь задать границы в input_kabat
* Во втором файле происходит усреднение скользящим окном размером avg_window_size - выбирается самый часто встречающийся рид в окне. Т.о. сглаживаются выбросы.
* Файл results.txt - результат предсказания в формате kabat. Так как строка с предсказанием на svm_window_size - 1 символ короче, то я расширяю границы первого и последнего региона на (svm_window_size - 1) / 2. Сейчас количество регионов в результате никак не коррелирует с количеством регионов в input_kabat.

Значения пока выглядят неправдоподобно, так как я делал предсказание для обучающей выборки, что неверно.
