{% extends "base.html" %}

{% block content %}
    {% if user.is_authenticated %}
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Backend ID</th>
                    <th>Тип запроса</th>
                    <th>Input FASTA</th>
                    <th>Input KABAT</th>
                    <th>Model path</th>
                    <th>Output dir</th>
                    <th>Group</th>
                    <th>Comment</th>
                    <th>Response</th>
                </tr>
            </thead>
            <tbody>
            {% for task in tasks %}
                <tr>
                    <td>{{ task.backend_id }}</td>
                    <td>{{ task.task }}</td>
                    <td>{{ task.input_file_fasta }}</td>
                    <td>{{ task.input_file_kabat }}</td>
                    <td>{{ task.model_path }}</td>
                    <td>{{ task.out_dir }}</td>
                    <td>{{ task.group }}</td>
                    <td>{{ task.comment }}</td>
                    <td>Hover this line to update status</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        <script type="text/javascript">
            $("tr").mouseover(function(){
                var backend_id = $(this).find("td:first").html()
                var updateField = $(this).find("td:last")
                event.preventDefault();
                if (updateField.html().indexOf('Hover') == -1) {
                    return false;
                }
                $.ajax({
                    type: "POST",
                    dataType: "json",
                    url: "{% url 'igsnooper:ask_backend' %}",
                    data: {"id": backend_id},
                    success: function (response) {
                        $("#backend_response").html(response);
                        var result = JSON.parse(response)
                        if (result['status'] == 'ok') {
                            var anchorElem = document.createElement('a');
                            anchorElem.setAttribute("href", "/listing/?file=" + result['data'][0]['fullpath']);
                            anchorElem.innerHTML = 'Result file';
                            updateField.html(anchorElem);
                        }
                    }
                });
                return false;
            });
        </script>
        <div id="backend_response">
            Backend response here
        </div>
    {% else %}
        {% include 'main/not_auth.html' %}
    {% endif %}
{% endblock %}